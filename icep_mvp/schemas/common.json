{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "common.json",
  "title": "ICEP Common Types",
  "$defs": {
    "id": {
      "type": "string",
      "minLength": 3,
      "maxLength": 128,
      "pattern": "^[A-Za-z][A-Za-z0-9_.:-]{2,127}$"
    },
    "timestamp": {
      "type": "string",
      "format": "date-time"
    },
    "labels": {
      "type": "object",
      "additionalProperties": {
        "type": "string",
        "maxLength": 256
      }
    },
    "actor": {
      "type": "object",
      "required": ["actor_id", "actor_type"],
      "properties": {
        "actor_id": { "$ref": "common.json#/$defs/id" },
        "actor_type": {
          "type": "string",
          "enum": ["agent", "human", "system"]
        },
        "display_name": {
          "type": "string",
          "maxLength": 256
        },
        "capabilities": {
          "type": "array",
          "items": { "type": "string", "maxLength": 128 },
          "uniqueItems": true
        }
      },
      "additionalProperties": false
    },
    "digest": {
      "type": "object",
      "required": ["algo", "hash"],
      "properties": {
        "algo": {
          "type": "string",
          "maxLength": 64
        },
        "hash": {
          "type": "string",
          "maxLength": 256
        }
      },
      "additionalProperties": false
    },
    "artifact_ref": {
      "type": "object",
      "required": ["uri"],
      "properties": {
        "uri": { "type": "string", "format": "uri" },
        "media_type": { "type": "string", "maxLength": 128 },
        "digest": { "$ref": "common.json#/$defs/digest" },
        "size_bytes": { "type": "integer", "minimum": 0 },
        "created_at": { "$ref": "common.json#/$defs/timestamp" }
      },
      "additionalProperties": false
    },
    "world_state_ref": {
      "type": "object",
      "required": ["type", "ref"],
      "properties": {
        "type": {
          "type": "string",
          "enum": ["git", "snapshot", "artifact", "uri", "custom"]
        },
        "ref": { "type": "string", "maxLength": 512 },
        "uri": { "type": "string", "format": "uri" },
        "path": { "type": "string", "maxLength": 512 },
        "digest": { "$ref": "common.json#/$defs/digest" }
      },
      "additionalProperties": false
    },
    "scope": {
      "type": "object",
      "properties": {
        "global": {
          "type": "boolean"
        },
        "paths": {
          "type": "array",
          "items": { "type": "string", "maxLength": 512 },
          "uniqueItems": true
        },
        "modules": {
          "type": "array",
          "items": { "type": "string", "maxLength": 256 },
          "uniqueItems": true
        },
        "interfaces": {
          "type": "array",
          "items": { "type": "string", "maxLength": 256 },
          "uniqueItems": true
        }
      },
      "anyOf": [
        { "required": ["global"] },
        { "required": ["paths"] },
        { "required": ["modules"] },
        { "required": ["interfaces"] }
      ],
      "additionalProperties": false
    },
    "evidence_requirement": {
      "type": "object",
      "required": ["type"],
      "properties": {
        "type": { "type": "string", "maxLength": 128 },
        "selector": { "type": "string", "maxLength": 512 },
        "min_count": { "type": "integer", "minimum": 0 },
        "required": { "type": "boolean" }
      },
      "additionalProperties": false
    }
  }
}
